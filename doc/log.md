# 历史更新日志
## 5.2
### 新增
- 支持 Docker 部署（感谢 @hujingnb ）
- `header_script` 配置项，以便自行部署的用户自定义访问统计或其他 js 代码
### 优化
- 使用了 pixiv.cat 提供的代理服务作为最后的保底方案
- 薄荷图床改为会员版本，需要购买会员后才能使用（免费版已失效）
- 完善图片下载完整度检查机制
- 去掉了内置的访问统计代码
### 其他
- 去掉失效的京东、imgurl、imgtg、saoren 图床

## 5.1
### 新增
- 京东、薄荷、58图床
- `static_cdn` 配置项，可以选择前端静态资源 CDN 供应商
### 优化
- 重写了左右翻页箭头，修复了它的一些问题
### 其他
- 去掉失效的百度、映画图床
- 将谷歌分析更换为百度统计

## 5.0
### 新增
- 支持跨域请求的数据接口
- clear-log 任务用于清除历史日志文件
- 共计 8 个国内外公开、免费的图床
### 优化
- 图片显示效果
- 左右翻页箭头现在会自动隐藏了
- 鼠标悬浮时显示作品标题及作者名称
- 升级前端依赖包至最新、减少依赖
- 完善日志记录功能
- 丰富接口数据以适应更多场景
- 将百度统计更换为谷歌统计
- 更新默认 UA
### 修复
- 部分情况下无法正确获取项目 url 的问题
- 部分情况下可能会下载到空白图片的问题
### 其他
- 去掉失效的阿里巴巴图床

## 4.4.2
- 更新 Curl 类的默认 UA
- 删除已经失效的图床
- 更新阿里巴巴图床
- 添加 `disable_web_job` 开关，详见 `config.php`

## 4.4.1
- 更新 Curl 类的默认 UA
- 修复部分情况下获取项目URL错误
- 修复获取排行榜数据失败时会无限重试的问题
- 优化是否需要更新数据的判断机制
- 删除已经失效的 alibaba 图床

## 4.4
- 改用官方 ajax 接口获取排行数据
- 添加 阿里巴巴、百度、今日头条 图床接口
- 更新 smms 图床接口到 v2 版本
- 删除已被废弃的 img.sb 图床接口
- 删除已被封锁的 京东 图床接口
- 删除 loading 页面的统计代码
- 改用综合排行榜数据，而非仅限于插画
- 图片数量限制扩充到 500，达到官方上限
- service 配置项的取值不再影响 limit
- 其他优化、bug 修复

## 4.3
- 修复Pixiv排行榜页面代码改版导致的无法更新
- 跳转至详情页时使用 https

## 4.2
- 修复Pixiv排行榜页面代码改版导致的无法更新
- 添加获取排行榜失败时的最大重试次数

## 4.1
- 现已支持透明背景

## 4.0
- 几乎重写了所有代码的船新版本，更多新特性与bug等你来发掘！
- 由于pixiv全面开启反盗链，为了迎合此变化。已将`download`和`url_cache`这两个不再有存在意义的开关去除。现在会强制下载缩略图，然后再根据配置上传到各个图床或存储在服务器本地
> 碎碎念：原本这个项目只是随便搞搞，没想到后面功能越堆越多，代码也越来越丑。作为本辣鸡github上最高star的项目实在是丢人。好在我花了几天时间撸了这个4.0，总算是不那么丢人了  
> 还有就是添加了多图床的支持，每个月能节省几百G的流量了嘤

## 3.0
- 添加`$download_proxy`配置项
- 由于Pixiv的图片url添加了防盗链无法被直接显示，因此`$download`配置项默认开启
  为了更好的显示效果，自行部署的用户建议配置一个定时任务，每天0点触发`download.php`

## 2.9
- 修复因Pixiv改动导致挂掉的问题

## 2.8
- 尝试优化更新锁，防止高并发下重复更新
- 从 Conf::$download 中独立出配置项 Conf::$url_cache，现在可以仅缓存图片url而不缓存缩略图了
- 添加贴图库图床支持

> 贴图库免费版并不是很好用且不支持https，建议优先使用sm.ms，贴图库仅作为备用
> 由于之前更新锁在高并发下有些问题无法很好的发挥作用，导致我的服务器IP因重复上传被sm.ms图床封了。而我个人也无力支撑高昂的CDN费用。<del>因此即日起**方案一**不再提供CDN加速，改为直接从P站获取图片</del>  
> 方案一目前由360网站卫士提供CDN支持

## 2.7
- 添加图片压缩功能，降低服务器带宽压力（需要GD库）
- 修复sm.ms图床支持，降低失败概率
- 添加sm.ms图床上传日志

> 如果开启`$enable_smms`出现问题，反馈时请带上日志文件

## 2.6
- 添加sm.ms图床支持。一键启用即可大幅降低服务器带宽压力、节省流量。感谢[@Showfom](https://sb.sb/)提供图床

> 我才不告诉你是因为方案一每天跑掉我几G流量，心疼不已才加的这个功能呢
> 如果连续3次上传失败，则从服务器本地读取图片，确保访问正常

## 2.5
- 修复因Pixiv改版导致挂掉的问题
- Pixiv原生支持https啦！可喜可贺

## 2.4
- 修复特定情况下URL的`limit`参数无效的问题
- 修复**方案一**缓存问题
- 修复上面效果图SSL证书问题

## 2.3
- 更换了前端库引用地址，修复移动宽带下加载慢的问题
- 添加协议自适应，修复在关闭缓存或缓存还没全部完成时影响小绿锁的问题
- 以上更新来自@灵乌路空 的友情PR，我们一起对她PRPR以示感激吧
- 超能小紫的方案一服务现已支持HTTPS。咬牙忍痛上了收费CDN，请大家且用且珍惜
- 要是被滥用到我吃不消费用的话可能会暂停服务噢~
- 如果访问量较高的话建议还是自行搭建服务，谢谢各位的支持与谅解

## 2.2
- 优化下载线程以支持自行部署HTTPS

## 2.1
- 规划2.0时脑子抽了，非要把所有逻辑都局限在一个文件里。虽然各方面确实有所提升，但在一些情况下照样会出现那些老问题。例如缩略图下载失败啊、PHP超时导致下载中断之类。因此在我测试并意识到这一点时，赶紧开始了新版本的开发 <del>光速打脸</del>
- 去除自动更新锁机制，缩略图已存在并且有效时不再重复下载。防止因网络波动或超时导致的缩略图下载失败

## 2.0
- 整体重构，各机制大幅优化
- 添加自动更新锁机制，避免高访问量时并发更新浪费资源
- 全新的伪多线程自动更新机制，后台更新不影响使用
- 更新失败重试，避免因为网络问题导致的部分图片获取失败

# 初衷
前几天跟朋友聊天，朋友说希望能在自己博客侧边栏中显示[Pixiv](http://www.pixiv.net/)的每日排行榜。我自己也是个`ACG`爱好者，被他这么一说也想弄一个。昨晚终于有空，花了半个多小时写完。[自己博客](https://www.mokeyjay.com)用上了感觉不错，完善了一下加了点功能开源出来福利各位